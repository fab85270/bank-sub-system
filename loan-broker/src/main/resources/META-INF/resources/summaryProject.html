<!DOCTYPE html>
    <head>
        <script>
            /* Déclaration d'une variable globale*/
            let projectIdTab = [];

            async function myFonction() {

                /*Initialisation d'un tableau vide*/
                    projectIdTab = [];
                    const response = await fetch("/broker/getProject", {
                        method: 'GET', // *GET, POST, PUT, DELETE, etc.
                        mode: 'cors', // no-cors, *cors, same-origin
                        cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
                        credentials: 'same-origin', // include, *same-origin, omit
                        headers: {
                            'Content-Type': 'application/json'
                            // 'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        redirect: 'follow', // manual, *follow, error
                        referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url// body data type must match "Content-Type" header
                    }).then(res => res.json());
                    console.log(response);


                    /* On va clear le document au début */
                    document.getElementById('p1').innerHTML = "";

                    for (const object in response) {
                        /* On remplit le document pour affichage*/

                        document.getElementById('p1').innerHTML +=
                            '<td> <br>Project numéro ' + object + ' : <br>' + '<br>Description : ' + response[object].projectDescription + '<br> Somme voulue : ' + response[object].demandedValue + ' euros<br>' + 'Date début souhaitée : ' + response[object].estimatedStartDate + '<br> Date de fin souhaitée : ' + response[object].estimatedDeadline + '<br> Projet délivré : ' + response[object].delivered + '<br>';


                        /*On stocke dans un tableau, tous les ID des différents projets qu'on recoit*/
                        /*Le project 0, sera associé à l'indice 0 du tableau.*/
                        projectIdTab.push(response[object].idProject);

                    }

            }

            function saisieProject(){
                console.log(projectIdTab);
                /* Récupération de la valeur saisie */
                let projectSaisie = document.getElementById("projectSaisie").value;

                console.log("Votre saiise est de : "+projectSaisie);

                /*Gestion des cas d'erreurs de saisies */

                if(projectSaisie > projectIdTab.length){window.alert("Error : Veillez saisir un numéro associé à un projet existant")}
                if(projectSaisie < 0){window.alert("Error : Le numéro de projet saisit doit être supérieur à 0")}
                if(projectIdTab.length ==0){window.alert("Error : Vous n'avez aucun project qui vous est associé")}
                //Gérer le cas de la saisie d'une chaine de caractère avec regexp javascript ?

                /* Récupération de l'identifiant du projet associé */

                let idProject = projectIdTab[projectSaisie];

                /*Envoie de cet ID par une requête POST vers notre application pour qu'elle soit traitée*/

                let _data = {
                    idProject: idProject
                }

                let xmlhttp = new XMLHttpRequest();   // new HttpRequest instance
                xmlhttp.open("POST", "/broker/sendIdProject");
                xmlhttp.setRequestHeader("Content-Type", "application/json");
                xmlhttp.send(JSON.stringify(_data));
            }

</script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <link rel="shortcut icon" href="#" />
    <style>
            body{
                background-color: antiquewhite;
            }
            .contenair{

            }
            .formulaire{
                margin: auto;
                width: 50%;
            }
            .presentation{
                padding-bottom: 40px;
            }
            .presentation h1,h3{
                text-align: center;
            }
            .form-check{
                text-align: center;
            }
        </style>
    </head>
    <body>
        <h1>Recapitulatif du projet Client</h1>
        <div>
            <p>
               Recapitulatif des projets de vos clients
            </p>
        </div>
        <div class="form-check">
            <input type="button" class="form-check-input" id="boutton" value="Afficher toutes les propositions de project" onclick="myFonction()"><br><br>
            <form id="myForm">
                <input type="number" class="form-control" id="projectSaisie" aria-describedby="emailHelp" placeholder="Saisie du numéro du projet à traiter" required="required">
                <input type="button" class="form-check-input" id="btn" value="Envoyer votre choix !" onclick="saisieProject()">
            </form>
        </div>
        <table>
            <td id ='p1'>

            </td>
        </table>

    </body>
</html>